---
title: Workflow Description Language (WDL) in Emacs
date: 2019-07-15
tags: ["emacs", "wdl"]
---



<p>I recently started working with <a href="https://software.broadinstitute.org/wdl/documentation/">WDL</a> files.
The Broad Institute recommends using Sublime and the <a href="https://github.com/broadinstitute/wdl-sublime-syntax-highlighter">syntax highlighter</a> that they provide.
They also provide a <a href="https://github.com/broadinstitute/vim-wdl">syntax highlighter for Vim</a>.</p>
<p>I started by looking for a <strong>solution in Emacs</strong>, my go-to editor.
Luckily there was already a WDL mode available that I just slightly improved.
I also made a polymode to complement it.
Both are available through <a href="https://github.com/melpa/melpa">MELPA</a> as <code>wdl-mode</code> and <code>poly-mode</code>.</p>
<p>Other useful commands include <code>(setq-default indent-tabs-mode nil)</code> and the <code>whitespace-mode</code> to ensure consistent indents (see the <a href="/emacs#for-wdl-workflows">Emacs’s WDL section</a>).</p>
<div id="wdl-mode" class="section level2">
<h2><code>wdl-mode</code></h2>
<p>The <a href="https://github.com/zhanxw/wdl-mode">wdl-mode package</a> provides <strong>syntax highlighting and indentation</strong>.
It was developed by <a href="https://github.com/zhanxw">Xiaowei Zhan</a>.</p>
<p>I noticed that the indentation was not triggered in the presence of space(s) after the character that should trigger it (<code>{</code>, <code>&lt;&lt;&lt;</code>, <code>}</code>, <code>&gt;&gt;&gt;</code>).
Maybe this space is not supposed to be there in the first place.
Still some the files I was working with (or some of <a href="https://github.com/DataBiosphere/topmed-workflows/blob/master/variant-caller/variant-caller-wdl/topmed_freeze3_calling.wdl">TOPMed’s workflows</a>) had those sometimes.
I think it’s worth catching those so I modified the package.
It’s now a <a href="https://github.com/zhanxw/wdl-mode/pull/3">PR in the main repo</a>.
If it’s not merged it could always be modified locally (e.g. in the <code>.emacs.d/elpa/wdl-mode*/wdl-mode.el</code>).</p>
</div>
<div id="poly-mode" class="section level2">
<h2><code>poly-mode</code></h2>
<p>Starting from existing polymodes, I wrote one for WDL.
The goal was to <strong>automatically switch to “<em>shell mode</em>” in the command chunks</strong>, mostly to get the appropriate indentation.
The <a href="https://github.com/jmonlong/poly-wdl">poly-wdl package</a> is now in MELPA and I’m glad I could contribute to MELPA even if just with a simple and field-specific package.</p>
</div>
<div id="screenshot" class="section level2">
<h2>Screenshot</h2>
<p>Here is an example of part of a TOPMed workflow for read alignment <a href="https://github.com/DataBiosphere/topmed-workflows/blob/master/aligner/u_of_michigan_aligner/u_of_michigan_aligner.wdl">available here</a>.
I removed empty lines and some comments to make it more compact.</p>
<p><img src="/imgs/emacs-wdl-ex.png" /></p>
</div>
